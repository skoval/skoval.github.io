<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Head-to-Head Effects - Stats On the T</title>
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<script type="text/javascript" async
	  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	  MathJax.Hub.Config({
	  tex2jax: {
	    inlineMath: [['$','$'], ['\\(','\\)']],
	    displayMath: [['$$','$$']],
	    processEscapes: true,
	    processEnvironments: true,
	    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
	    TeX: { equationNumbers: { autoNumber: "AMS" },
	         extensions: ["AMSmath.js", "AMSsymbols.js"] }
	  }
	  });
	  MathJax.Hub.Queue(function() {
	    
	    
	    
	    var all = MathJax.Hub.getAllJax(), i;
	    for(i = 0; i < all.length; i += 1) {
	        all[i].SourceElement().parentNode.className += ' has-jax';
	    }
	  });

	  MathJax.Hub.Config({
	  
	  TeX: { equationNumbers: { autoNumber: "AMS" } }
	  });
	</script>
	<meta name="description" content="">
	<meta property="og:title" content="Head-to-Head Effects" />
<meta property="og:description" content="Matchup effects are a common idea in tennis commentary. It is the thing at the heart of comments like &lsquo;her game matches up well&rsquo; against her opponent. One way to think of a matchup effect is as a surprising head-to-head, when results go against what the overall ability of both players would have us expect. Do such effects exist? And are they substantial enough that they matter when it comes to making better predictions about tennis results?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://skoval.github.io/2019/03/15/head-to-head-effects/" />
<meta property="article:published_time" content="2019-03-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-03-15T00:00:00+00:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-100138539-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Stats On the T" rel="home">
				<div class="logo__title">Stats On the T</div>
				<div class="logo__tagline">Dedicated to data, statistics, and tennis</div>
			</a>
			<div class="logo-img">
				<img src="/img/logo.png" />
			</div>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/contact/">
				
				<span class="menu__text">Contact</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/features/">
				
				<span class="menu__text">Features</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/ratings/ratings/">
				
				<span class="menu__text">Ratings</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/research/">
				
				<span class="menu__text">Research</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/software/">
				
				<span class="menu__text">Software</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Head-to-Head Effects</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-03-15T00:00:00">March 15, 2019</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/matchups/" rel="category">matchups</a>, <a class="meta__link" href="/categories/head-to-head/" rel="category">head-to-head</a>
	</span>
</div></div>
		</header>
	<div class="content post__content clearfix">
			<p>Matchup effects are a common idea in tennis commentary. It is the thing at the heart of comments like &lsquo;her game matches up well&rsquo; against her opponent. One way to think of a matchup effect is as a surprising head-to-head, when results go against what the overall ability of both players would have us expect. Do such effects exist? And are they substantial enough that they matter when it comes to making better predictions about tennis results?</p>
<p>I&rsquo;ve been working on predicting wins in tennis for some time. Whenever I&rsquo;ve had a chance to talk about the method with tennis insiders, there is always one question I know will come up (if only predicting match results was as easy to forecast!). That is, whether I account for head-to-head.</p>
<p>In one sense, any method that includes the historical results of a player is accounting for head-to-head. But I know that this isn&rsquo;t exactly what the question is getting at. The question really comes down to matchup effects and the particular edge one player might have over a specific opponent that goes beyond what their ability would predict, factors like style or intimidation, for example.</p>
<div class="getty embed image" style="background-color:#fff;display:inline-block;font-family:Roboto,sans-serif;color:#a7a7a7;font-size:11px;width:100%;max-width:346px;float:right;padding:2%;"><div style="padding:0;margin:0;text-align:left;"><a href="http://www.gettyimages.com.au/detail/632272708" target="_blank" style="color:#a7a7a7;text-decoration:none;font-weight:normal !important;border:none;display:inline-block;">Embed from Getty Images</a></div><div style="overflow:hidden;position:relative;height:0;padding:133.18387% 0 0 0;width:100%;"><iframe src="//embed.gettyimages.com/embed/632272708?et=Pnu07HXxQEBKeqKEuoK3jw&tld=com.au&sig=_iwtMySBQO2CGEQ1TNSFYG-QFpe0Ou8zYSML9kFZtBM=&caption=true&ver=1" scrolling="no" frameborder="0" width="446" height="594" style="display:inline-block;position:absolute;top:0;left:0;width:100%;height:100%;margin:0;"></iframe></div></div>
<p>Most prediction methods (and I&rsquo;ve explored many over the years) assume that players abilities are transitive. That is, if player A is two times greater in overall ability than players B and C, than his win expectations in a match against B and C should be equal. Matchup effects throw a wrench into the transitive property and effectively act like an interaction term, where the overall abilities of players can&rsquo;t in themselves explain the results of their matches against each other.</p>
<p>That description gets us on track to how we might identify the presence of head-to-head effects. Suppose we have our favourite approach for predicting the chance player $i$ wins a match against player $j$ that <em>doesn&rsquo;t</em> account for matchup effects (so this might exclude bookmaker odds, for example). Call this expectation $\hat{p}_{ij}$. A basic model to account for head-to-head is:</p>
<p><code>$$logit[P(W_{ij} = 1)] = \beta_0 + \beta_1  \hat{p}_{ij} + \alpha_{ij}$$</code></p>
<p>The parameter <code>$\alpha_{ij}$</code> is the key here. It is an unknown constant for the specific matchup that adjusts our expectations when <code>$\hat{p}_{ij}$</code> assumes abilities are transitive.</p>
<h2 id="what-is-a-typical-head-to-head">What is a Typical Head-to-Head?</h2>
<p>Before we fit such a model, even before we decide whether to use likelihood-based or Bayesian methods, we need to decide which data to use. Just considering the men&rsquo;s game, do we include Futures? Challengers? or limit it to ATP events only?</p>
<p>The answer comes down to where most repeat clashes are happening. We know that tennis is a pyramid, with the size of the competitive pool shooting upward the lower down you go down the tournament tier. We might suspect that, for this reason, players at the Challenger level, for example, will not often build up substantial head-to-heads against other players on the tour.</p>
<p>But what does the data actually show?</p>
<p>Considering all matches played in the past 10 years at the Challenger level having any head-to-head turns out to be quite. If we consider how likely it is that two players drawn at random from the competitor pool (anyone who ever competed in a Challenger event or better during this period) have played each other in competition before, the chance is just 2 out of 100. The chance that any random pairs has a match history of 3 or more is a 3 in 1000 chance. We might have already thought that the 53-match rivalry of Nadal and Djokovic was unusually long but this summary tells us that even a 3-match history is a 1% of 1% event in the professional game.</p>
<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >
<thead>
<tr>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Head-to-Head Sample Size</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Frequency (+ Challengers)</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Frequency (- Challengers)</th>
</tr>
</thead>
<tbody>
<tr>
<td style='text-align: center;'>0</td>
<td style='text-align: center;'>98.4%</td>
<td style='text-align: center;'>96.0%</td>
</tr>
<tr>
<td style='text-align: center;'>1</td>
<td style='text-align: center;'>1.2%</td>
<td style='text-align: center;'>2.5%</td>
<tr>
<td style='text-align: center;'>2</td>
<td style='text-align: center;'>0.3%</td>
<td style='text-align: center;'>0.8%</td>
</tr>
<tr>
<td style='text-align: center;'>3+</td>
<td style='text-align: center;'>0.1%</td>
<td style='text-align: center;'>0.7%</td>
</tr>
</tr>
</tbody>
</table>
<p>Even if we drop Challenger events, the break down doesn&rsquo;t change dramatically. Among players competing primarily at the tour-level, the chance is still under 1% that any pair among them will have played 3 matches or more over a 10 year period.</p>
<p>Why does any of this matter for estimating head-to-head effects? If there are many cases of player-opponent matchups with a single match, it can impact the accuracy of estimates of the head-to-head effects, pulling all effects closer to zero than would be the case with a less sparse sample.</p>
<p>The infrequency of lengthy head-to-heads also suggests that any adjustment for them (if such were warranted) is unlikely to have a substantial improvement in prediction performance more generally. The number of matches in a season that would involve players with an even moderate match history would be few. But we will come back to this later.</p>
<p>We have seen that having played more than 3 matches against an opponent is an unusually long history compared to the norm. Among matches played for players in this &lsquo;long&rsquo; rivalry subgroup, 1 in 3 of the matches happened at the Challenger level, 1 in 4 at the 250 level, and 1 in 5 at the Masters level.</p>
<div>
<img src="/img/h2h_tier.png" />
</div>
<h2 id="head-to-head-effects">Head-to-Head Effects</h2>
<p>Given the preponderance of singleton head-to-heads, I will examine matchup effects among player-opponent pairs with a history of 2 or more matches prior to 2018 at the Challenger level or above (reserving 2018 and 2019 matches for out-of-sample testing).</p>
<p>For the $\hat{p}_{ij}$, I will use a surface-adjusted Elo rating<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. This is a dynamic transitive model that also accounts for surface specialty. In using this as the prediction covariate, the aim is for the head-to-head to capture any intransitive effects no explained by the overall ability or surface preferences of the players.</p>
<p>When a logistic mixed model was fit to these matchups, the standard deviation for the player-opponent random effect was $\sigma = 0.40$, suggesting evidence of matchup effects. When we look at the conditional means for the specific effect estimates $\hat{\alpha}_{ij}$  1 in 6 would imply an adjustment in predictions of 15% or more.  Another indication of statistically meaningful head-to-head effects.</p>
<p>The chart below is a forest plot of the 100 biggest head-to-head effects found in the men&rsquo;s sample. The effect is expressed in terms of the factor you would multiply the standard odds by for these players to account for the head-to-head effect. The player who benefits from the head-to-head effect is the one on the left in the x-axis labels. Larger dots indicate the effects with greater relative certainty.</p>
<p>There are a lot of interesting things to pick out of these effects (and it is only a sample of the 100 largest ones!). At the very top of the chart we see a cluster of head-to-heads involving Stan Wawrinka and Tomas Berdych, their own head-to-head being the one with the largest effect overall. These two have faced each other 16 times in their career with Wawrinka leading 11 to 5; 10 times since 2010 with Wawrinka dropping just 1 match. My surface-adjusted ratings show that Berdych was ahead of Wawrinka for all of their last 10 matches, though they have also been close, differing by no more than 50 points at any one occasion. That would make Wawrinka&rsquo;s edge over Berdych look surprisingly lopsided.</p>
<p>It is a similar story with Wawrinka&rsquo;s matchup against Cilic. Wawrinka has won all of their 8 most recent matches (they&rsquo;ve faced each other 14 times overall) despite Cilic surpassing Wawrinka in the player ratings in 2016 and 2017.</p>
<div>
<img src="/img/h2h_effects.png" />
</div>
<p>There are several players who pop up in multiple of the biggest head-to-head effects. Fabio Fognini features 7 times in the list, having the benefit of the matchup class for 5 of these, with the biggest edge being over Roberto Bautista Agut.</p>
<p>Berdych is the next most frequently occurring player in the list with 6 head-to-heads, which is the same number that Horacio Zeballos appears in. David Ferrer comes up in a total of 5 of the head-to-heads and is at the wrong end of the stick for 4 of the 5 (vs Andy Murray, Novak Djokovic, Stan Wawrinka, and Kei Nishikori). Ferrer is an interesting case because he is often considered one of the best players who always came short against the Big 4. This tells us that the head-to-head effects could also come up when a player has a ceiling effect in their ability and not necessarily playing style clashes alone.</p>
<p>There are some head-to-heads people might have expected to see in the top 100 that don&rsquo;t appear. Rafael Nadal and Roger Federer is one. The head-to-head effect in this case gives a 7% boost to Rafael Nadal, not insignificant but also not as big as some might have thought. I think this can be explained by the fact that most of Nadal&rsquo;s wins over Federer have been on clay (13 of 23) where his surface-adjusted rating would have explained that record.</p>
<p>The clash between Federer and Wawrinka gets a bigger head-to-head effect, with Federer getting a 20% boost in his odds when facing Wawrinka. That would make Federer&rsquo;s recent win over Wawrinka at Indian Wells that much less surprising.</p>
<p>Another interesting matchup with relevance for Indian Wells was Gael Monfils win over Philipp Kohlschreiber. With Kohlschreiber coming off a massive upset over Novak Djokovic, many might have thought it was his time to go deep. Monfils was going to be a hard opponent for anyone but the head-to-head effect suggest it is an especially tricky matchup for Kohli, whose matchup against Monfils puts him in the top 100 and would give him a 30% disadvantage against Monfils.</p>
<h2 id="prediction-improvement">Prediction Improvement</h2>
<p>We don&rsquo;t even have to apply the head-to-head correction to know that it isn&rsquo;t going to move prediction improvement upward for the majority of matches. There are just too few matches between players who have played each other at all in the past to get any benefit from such an adjustment. But that doesn&rsquo;t mean that the correction isn&rsquo;t valuable.</p>
<p>The nature of tennis means that the biggest rivalries will tend to be between the most well-known players. The three biggest rivalries in the dataset used in this post are Nadal v Djokovic, Federer v Djokovic, and Djokovic v Murray. So, although the occurrence of big n head-to-heads are rare, they are high impact matches when they occur.</p>
<p>So if we focus just on matches where head-to-head might matter, what do we find? Using matches from 2018-2019 as the test data, there were 754 that involved players with a head-to-head history of more than 3 matches. The overall change in prediction accuracy from the standard prediction to one with the head-to-head correction was negligible for this group.</p>
<table class='gmisc_table' style='border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;' >
<thead>
<tr>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Match Type</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Number of Matches</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>Standard Prediction Accuracy</th>
<th style='border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;'>+H2H Prediction Accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td style='text-align: left;'>Matchups with n>3 Match History</td>
<td style='text-align: center;'>754</td>
<td style='text-align: center;'>66.6%</td>
<td style='text-align: center;'>66.7%</td>
</tr>
<tr>
<td style='text-align: left;'>Subgroup of Close Matches</td>
<td style='text-align: center;'>233</td>
<td style='text-align: center;'>54.9%</td>
<td style='text-align: center;'>55.4%</td>
<tr>
<td style='text-align: left;'>Subgroup where H2H Changed Predicted Winner</td>
<td style='text-align: center;'>21</td>
<td style='text-align: center;'>47.6%</td>
<td style='text-align: center;'>52.4 %</td>
</tr>
</tbody>
</table>
<p>If we look at the subset among these that were <em>close</em>, where the standard prediction was somewhere between 40% and 60%, does the correction perform any better? The accuracy was 55.4% with head-to-head effects versus 54.9%, which is an improvement but one that might not hold up with repeated sampling, given that it is based on 233 matches.</p>
<p>The final subgroup we consider are the cases where the consideration of head-to-head actually reversed the favoured player (the player with &gt;50% win expectation). There were only 21 matches of this type, a small sample, but one that showed the biggest difference in the use of head-to-head or not, with a 5 point gain in accuracy for the prediction with the head-to-head correction.</p>
<p>Because this last subgroup is an especially interesting one, and a group where the correction for matchup has the biggest impact, I&rsquo;ve plotted each of those matches below. The result and predictions are all with respect to the first player in the matchup.</p>
<div>
<img src="/img/h2h_reversal.png" />
</div>
<p>The chart shows, for example, that Stefanos Tsitsipas would have gotten +2 percentage points toward his win prediction when he faced David Goffin this year in Marseille owing to the head-to-head correction, a match he did win.</p>
<p>Although there were more changes in the right direction, there were plenty in the wrong direction as well. Marin Cilic&rsquo;s loss to Alexander Zverev at the 2018 ATP World Tour Finals is a prime example. The head-to-head correction pulled the match much more in favour of Cilic (53% versus 45%) but the match went to Zverev in that instance.</p>
<h2 id="style-versus-head-to-head">Style versus Head-to-Head</h2>
<p>Even with some evidence of improvement in close matches with lengthy head-to-heads, small sample sizes still make adjusting for head-to-head difficult. The most obvious way to overcome this would be to look at grouping players by their style of play, which would allow us to draw strength from players with similar styles to estimate matchup effects. It is the obvious path but how to go about defining playing style if far from clear. For now, adjustment for specific head-to-heads has some merits and also reveals both expected and surprising results about the biggest matchup effects in the game.</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Technically, the Elo rating system supposes a linear relationship between the log odds for the win and the rating difference of the player. However, using the probability transformation of the prediction has some advantages in terms of numerical stability of the model. But the choice of transformation doesn&rsquo;t have a huge impact on the results either way. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/matchups/" rel="tag">matchups</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/head-to-head/" rel="tag">head-to-head</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Stephanie Kovalchik avatar" src="/img/IMG_0842.JPG" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Stephanie Kovalchik</span>
	</div>
	<div class="authorbox__description">
		Senior data scientist at Zelus Analytics, dedicated to using advanced stats to get more value out of performance analysis in elite sport.
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/2019/03/07/indian-wells-atp/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Men&#39;s Title Predictions for Indian Wells</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/2019/03/22/head-to-head-effects-wta/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">WTA Head-to-Head Effects</p></a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "on-the-t-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Stats On the T.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>