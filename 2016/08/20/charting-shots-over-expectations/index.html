<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Charting Shots Over Expectations - Stats On the T</title>
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
	 <script src="https://d3js.org/d3.v4.js"></script>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<script type="text/javascript" async
	  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	  MathJax.Hub.Config({
	  tex2jax: {
	    inlineMath: [['$','$'], ['\\(','\\)']],
	    displayMath: [['$$','$$']],
	    processEscapes: true,
	    processEnvironments: true,
	    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
	    TeX: { equationNumbers: { autoNumber: "AMS" },
	         extensions: ["AMSmath.js", "AMSsymbols.js"] }
	  }
	  });
	  MathJax.Hub.Queue(function() {
	    
	    
	    
	    var all = MathJax.Hub.getAllJax(), i;
	    for(i = 0; i < all.length; i += 1) {
	        all[i].SourceElement().parentNode.className += ' has-jax';
	    }
	  });

	  MathJax.Hub.Config({
	  
	  TeX: { equationNumbers: { autoNumber: "AMS" } }
	  });
	</script>
	<meta name="description" content="">
	<meta property="og:title" content="Charting Shots Over Expectations" />
<meta property="og:description" content="In statistics, an expectation is a way to quantify what is typical or likely. And, when we compare what actually happened against what was expected, we have a way to judge how surprised or unimpressed we should be.
Despite their usefulness, you are as likely to see a probabilistic expectation in tennis as you are a floral pattern at Wimbledon. Mainstream tennis stats only report what happened, not what was likely to happen." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://skoval.github.io/2016/08/20/charting-shots-over-expectations/" />
<meta property="article:published_time" content="2016-08-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-08-20T00:00:00+00:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-100138539-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Stats On the T" rel="home">
				<div class="logo__title">Stats On the T</div>
				<div class="logo__tagline">Dedicated to data, statistics, and tennis</div>
			</a>
			<div class="logo-img">
				<img src="/img/logo.png" />
			</div>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/contact/">
				
				<span class="menu__text">Contact</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/features/">
				
				<span class="menu__text">Features</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/ratings/ratings/">
				
				<span class="menu__text">Ratings</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/research/">
				
				<span class="menu__text">Research</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/software/">
				
				<span class="menu__text">Software</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Charting Shots Over Expectations</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2016-08-20T00:00:00Z">August 20, 2016</time></div></div>
		</header>
	<div class="content post__content clearfix">
			<p>In statistics, an <em>expectation</em> is a way to quantify what is typical or likely. And, when we compare what <em>actually happened</em> against what was expected, we have a way to judge how surprised or unimpressed we should be.</p>
<p>Despite their usefulness, you are as likely to see a probabilistic expectation in tennis as you are a floral pattern at Wimbledon. Mainstream tennis stats only report what happened, not what was likely to happen. This is really too bad because it makes it makes it that much harder for fans to judge the quality of a player&rsquo;s performance.</p>
<div class="getty embed image" style="background-color:#fff;display:inline-block;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#a7a7a7;font-size:11px;width:100%;max-width:594px;float:left;padding:2%;"><div style="padding:0;margin:0;text-align:left;"><a href="http://www.gettyimages.com/detail/591901980" target="_blank" style="color:#a7a7a7;text-decoration:none;font-weight:normal !important;border:none;display:inline-block;">Embed from Getty Images</a></div><div style="overflow:hidden;position:relative;height:0;padding:66.666667% 0 0 0;width:100%;"><iframe src="//embed.gettyimages.com/embed/591901980?et=WP1KShoFRERqB-CafJ4vXg&viewMoreLink=off&sig=wOWfpr92S9o3aNBGonZnbnC5LRC0pUZn-QJJtG89mNU=&caption=true" width="400" height="250" scrolling="no" frameborder="0" style="display:inline-block;position:absolute;top:0;left:0;width:100%;height:100%;margin:0;"></iframe></div><p style="margin:0;"></p></div>
<p>Consider Borna Coric&rsquo;s upset of Rafael Nadal just a day ago at the <a href="http://www.tennis.com/pro-game/2016/08/dimitrov-upsets-2nd-seed-wawrinka-in-cincinnati/60035/">Western and Southern Open</a>. If we looked at the <a href="http://www.atpworldtour.com/en/tournaments/western--southern-open/422/2016/match-stats/cg80/n409/match-stats?">mainstream match summary for that win</a>, we would learn, for example, that Coric won 73% of service points and 53% of return points; whereas Nadal won just 47% and 27% of the same points. This tells us how much Coric outperformed Nadal on each stat but it doesn&rsquo;t tell us how much he might have outperformed his expected performance for the match, or how much Nadal performed below his expectations.</p>
<h2 id="accounting-for-expectations">Accounting for Expectations</h2>
<p>My last post suffered from the same problem. I presented a method for showing the frequency of serve locations for a particular plot using hexagonal binning with <em>ggplot2</em>. Using Roger Federer&rsquo;s serves from the 2016 Australian Open, we found that his first serves are most often near the lines of the service box wide or down the T.</p>
<p>This information is useful by itself, but we might also like to know how different Federer&rsquo;s patterns are compared to other players. In other words, how does Federer&rsquo;s <em>expected</em> serve locations compare to a typical player on the ATP Tour.</p>
<p>So, in this post, I want to explore how to make a shot chart that shows frequencies above average. Here, &ldquo;the average&rdquo; Federer will be compared to are the serves of all other players at the 2016 Australian Open.</p>
<p>The first step is obtaining the hexagonal bins for each group. We can get the summary results for bins of a fixed width and height using the <code>ggplot_build</code> function. Below, using bins with a width and height of half a meter, we apply <code>ggplot_build</code> to Federer&rsquo;s serves and all serves. The <code>data</code> element from this function contains a <code>data.frame</code> that has a summary of the center of each bin and the frequency of serves assigned to that bin.</p>
<pre><code>
gg1 <- ggplot(data = federer, aes(x = center_x, y = center_y)) +
  facet_grid(serve ~ .) +
  geom_hex(colour = "white", binwidth = c(.5, .5)) 
  
gg2 <- ggplot(data = atp_serves, aes(x = center_x, y = center_y)) +
  facet_grid(serve ~ .) +
  geom_hex(colour = "white", binwidth = c(.5, .5)) 
  
federer_data <- ggplot_build(gg1)$data[[1]]
tour_data <- ggplot_build(gg2)$data[[1]]
</code></pre>
<p>The next stage is to compute percentages for each bin, which is what will be used to summarise the <em>expected</em> location for a serve of Federer&rsquo;s versus the <em>expectation</em> for a serve of an arbitrary tour player at a Grand Slam. This is done below by the <code>Panel</code> factor, which is an indicator for first or second serves in this example.</p>
<pre><code>
federer_data <- federer_data %>%
  group_by(PANEL) %>%
  dplyr::mutate(
    percent = value / sum(value)
  )

tour_data <- tour_data %>%
  group_by(PANEL) %>%
  dplyr::mutate(
    percent = value / sum(value)
  )
</code></pre>
<p>Now, we are ready to the merge the bins together. This is the tricky part, as we don&rsquo;t want to require an exact match of locations. Instead, we right a function that looks to see if each center of a tour bin is within the bin region of Federer&rsquo;s servers. If it is, we assign that to the same center of Federer&rsquo;s matching bin, which will allow us to easily merge the serves by their location. Here is what this looks like.</p>
<pre><code>
for(i in 1:nrow(tour_data)){
  
  matching_bin <- tour_data$PANEL[i] == federer_data$PANEL & 
    tour_data$x[i] >= federer_data$x - .25 & 
    tour_data$x[i] < federer_data$x + .25 & 
    tour_data$y[i] >= federer_data$y - .25 & 
    tour_data$y[i] < federer_data$y + .25
  
  if(any(matching_bin)){

    tour_data$x[i] <- federer_data$x[which(matching_bin)[1]]
    tour_data$y[i] <- federer_data$y[which(matching_bin)[1]]
  }
}
  
    
combined <- merge(federer_data, tour_data, by = c("PANEL", "x", "y"), all = TRUE)
combined$percent.x[is.na(combined$percent.x)]  <- 0
combined$percent.y[is.na(combined$percent.y)]  <- 0

combined <- combined %>%
  group_by(PANEL, x, y) %>%
  dplyr::summarise(
    percent.x = sum(percent.x),
    percent.y = sum(percent.y)
  )

combined$diff <- combined$percent.x - combined$percent.y # How much more frequent than Federer
</code></pre>
<p>Once all of this is completed, we are able to put together a plot. In this case, I&rsquo;ll use a simple <code>geom_point</code> with a gradient by the relative difference, <code>diff</code>. The <code>diff</code> is multiplied by 1,000 so that the counts shown represent what would be expected out of 1,000 serves of Federer compared to 1,000 serves of a typical tour player.</p>
<p>The result highlights that Federer&rsquo;s tendencies on the lines are surprising when compared to other players, even those who are competing at a Grand Slam. On first serve, Federer&rsquo;s down the T frequency is unusually high. We also see that the frequency of the corner wide shots to the Deuce court are more likely than what is typical for other players.</p>
<p>The second serve patterns are particularly interesting. When we previously looked at Federer&rsquo;s serves alone, it seemed that the serves were more shallow and to the center of the court than on the first serve, but otherwise looked uniform across the width of the service box. Now, when compared to the general second serve patterns of the tour we see that he is still hitting the lines more than other players.</p>
<pre><code>
ggplot(data = combined, aes(x = x, y = y)) +
  facet_grid(PANEL ~ ., labeller = labeller_function) +
  geom_rect(aes(xmin = -11.89, xmax = 11.89, ymin = -5.49, ymax = 5.49), fill = '#1e90ff') +
  geom_path(data = court_trace, aes(x = x, y = y), color = "black", size = 1) +
  geom_point(aes(colour = diff * 1000, size = abs(diff))) +
  scale_colour_gradient(name = "Serves Above Average (per 1,000)", 
                        low = 'blue', high = 'yellow', breaks = seq(-20, 30, by = 10)) + 
  scale_y_continuous("", lim = c(-7, 7), breaks = NULL) +
  scale_x_continuous("", lim = c(-12, 12), breaks = NULL) +
  theme_hc() + 
  theme(legend.position = "bottom") + 
  scale_size_continuous(range = c(1, 4), guide = FALSE)
</code></pre>
<img src="/assets/merged_bin_shotchart-1.png">
<p>The next plot repeats the same steps but now restricts the pattern to all good serves. This makes Federer&rsquo;s ability to hit lines on the first and second serves even more apparent.</p>
<img src="/assets/merged_bin_shotchart2-1.png">
<h2 id="summary">Summary</h2>
<p>Statistical expectations help to give context to performance patterns. In this post, I have shown a simple version of an expectation that compares serve location pattern against the tour average and how it can be plotted as a shot chart. Just as this comparison provided some new insights about Federer&rsquo;s serve accuracy compared to other tour players, better contextualizing of other performance stats would likely have similar advantages.</p>

		</div>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Stephanie Kovalchik avatar" src="/img/IMG_0842.JPG" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Stephanie Kovalchik</span>
	</div>
	<div class="authorbox__description">
		Senior data scientist at Zelus Analytics, dedicated to using advanced stats to get more value out of performance analysis in elite sport.
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/2016/08/18/charting-serve-locations/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Charting Serve Locations</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/2016/08/29/us-open-womens-first-round-preview/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">US Open Women&#39;s First Round Clutch Preview</p></a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "on-the-t-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 Stats On the T.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>